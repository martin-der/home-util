group 'net.tetrakoopa'
version '1.0-SNAPSHOT'

/*class MyDownload extends DefaultTask {

	@Input
	String sourceUrl

	@OutputFile
	File target

	@TaskAction
	void download() {
		def f = new File(sourceUrl)
		if (!f.exists()) {
			new URL('the url').withInputStream{ i -> f.withOutputStream{ it << i }}
		}
	}
}*/

def distributedName = "home-util-${project.version}"


task wrapper(type: Wrapper) {
	gradleVersion = '3.4.1'
}

task archiveZip(type: Zip) {

	baseName = "home-util-${project.version}"

	destinationDir = new File('output/distrib')

	from fileTree('./').include('*.sh', '*.py', 'README.md')
}

task selfExtractingArchive( dependsOn: 'archiveZip') {

	doLast {

		/*task downloadSomething(type: MyDownload) {
			sourceUrl = 'https://raw.githubusercontent.com/megastep/makeself/master/makeself.sh'
			target = file('build/makeself.sh')
		}*/

		/*new File('build/tool/makeself').mkdirs()
		// https://raw.githubusercontent.com/megastep/makeself/master/makeself.sh
		def f = new File('build/tool/makeself/makeself.sh')
		if (!f.exists()) {
			new URL('https://raw.githubusercontent.com/megastep/makeself/master/makeself.sh').withInputStream{ i -> f.withOutputStream{ it << i }}
		}
		f = new File('build/tool/makeself/makeself-header.sh')
		if (!f.exists()) {
			new URL('https://raw.githubusercontent.com/megastep/makeself/master/makeself-header.sh').withInputStream{ i -> f.withOutputStream{ it << i }}
		}*/

		copy {
			from zipTree(file("output/distrib/${distributedName}.zip"))
			into 'output/installer/unpacked'
		}
		copy {
			from file('build/template/install.sh')
			into 'output/installer'
		}

		exec {
			commandLine 'sh', 'build/tool/makeself/makeself.sh', './output/installer', "output/distrib/${distributedName}.run", "Home-Util", './install.sh'
		}

	}

}


